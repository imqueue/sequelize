{"version":3,"file":"BaseModel.js","sourceRoot":"","sources":["BaseModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * @imqueue/sequelize - Sequelize ORM refines for @imqueue\n *\n * Copyright (c) 2019, imqueue.com <support@imqueue.com>\n *\n * Permission to use, copy, modify, and/or distribute this software for any\n * purpose with or without fee is hereby granted, provided that the above\n * copyright notice and this permission notice appear in all copies.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\n * AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\n * LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\n * OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\n * PERFORMANCE OF THIS SOFTWARE.\n */\n/**\n * This modules provides several additional features on top of\n * original Sequelize ORM implementation:\n *  1. Support of views. To define a model as a view in database, use\n *     @View(CREATE_VIEW_SQL: string) decorator factory\n *     @example\n *     ~~~typescript\n *     @View(\n *       `CREATE OR REPLACE VIEW \"ProductRevenue\" AS\n *        SELECT \"productId\" as \"id\", SUM(\"payment\") as \"revenue\"\n *        FROM \"Order\" GROUP BY \"productId\"`\n *     )\n *     export class ProductRevenue extends BaseModel<ProductRevenue> {\n *         @Column(DataType.BIGINT)\n *         @PrimaryKey\n *         public readonly id: number;\n *\n *         @Column(DataType.NUMBER({ decimals: 2, precision: 12 }}))\n *         public readonly revenue: number;\n *     }\n *     ~~~\n *     All views would be automatically synced after all tables synced, when\n *     Sequelize.sync() called.\n *\n *  2. Support of { returning: [field1, field2, ...] } instead of\n *     { returning: boolean }. This gives an ability to fetch and return only\n *     requested properties during insert/update operations. By the way it\n *     would require to cast the proper options type passed to corresponding\n *     sequelize operation. Those types have been mimic in this module, so\n *     them should be exported from it:\n *     @example\n *     ~~~typescript\n *     import { SaveOptions, Scope, UpdateOptions } from './orm';\n *     //\n *     // ... init models and somewhere inside async function:\n *     //\n *     const scope = new Scope({\n *       name: 'test',\n *       description: 'Test Scope',\n *       schema: {},\n *     });\n *     // take into account type casting to prevent TS errors:\n *     await scope.save({ returning: ['id', 'name'] } as SaveOptions);\n *     console.log(JSON.stringify(scope)); // {\"id\":2,\"name\":\"test\"}\n *     // or\n *     const [count, scopes] = await Scope.update({ name: \"TEST\" }, {\n *       where: { id: 2 },\n *       // take into account type casting to prevent TS errors:\n *       returning: ['id', 'name'] as UpdateOptions,\n *     });\n *     console.log(JSON.stringify(scopes)); // {\"id\":2,\"name\":\"TEST\"}\n *     ~~~\n *     This behavior gives an ability to reduce data exchange between DB and\n *     application as well as between app and external source as far as\n *     serialized model will contain only requested data (if any remote source\n *     applicable).\n *     So, whenever you found TS error about returning option on your code,\n *     simply cast options to the same type name as error states, but import\n *     this type from this module.\n */\nimport Promise = require('bluebird');\nimport {\n    BuildOptions as BuildOptionsOrigin,\n    BulkCreateOptions as BulkCreateOptionsOrigin,\n    CreateOptions as CreateOptionsOrigin,\n    DropOptions,\n    FindOptions,\n    Identifier,\n    ModelAttributes,\n    ModelOptions,\n    QueryInterface as QueryInterfaceOrigin,\n    QueryOptions as QueryOptionsOrigin,\n    QueryOptionsWithType,\n    QueryOptionsWithWhere,\n    SaveOptions as InstanceSaveOptionsOrigin,\n    SyncOptions as SyncOptionsOrigin,\n    UpdateOptions as UpdateOptionsOrigin,\n    UpsertOptions as UpsertOptionsOrigin,\n    WhereOptions,\n} from 'sequelize';\nimport {\n    DataType,\n    Model,\n    Sequelize as SequelizeOrigin,\n} from 'sequelize-typescript';\nimport QueryTypes = require('sequelize/types/lib/query-types');\nimport { ColumnIndexOptions } from './decorators/index';\n\nexport type Modify<T, R> = Pick<T, Exclude<keyof T, keyof R>> & R;\n\n/**\n * Original toJSON method from sequelize's Model class.\n */\nconst toJSON = Model.prototype.toJSON;\n\n/**\n * Extends original SyncOptions from Sequelize to add view support\n */\nexport interface SyncOptions extends SyncOptionsOrigin {\n    treatAsView?: boolean;\n    withNoViews?: boolean;\n}\n\nexport interface ReturningOptions {\n    returning?: boolean | string[];\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport type IModelClass<T extends BaseModel<T>> = new () => T;\n\n// noinspection JSUnusedGlobalSymbols\nexport type UpsertOptions =\n    Modify<UpsertOptionsOrigin, ReturningOptions>;\n// noinspection JSUnusedGlobalSymbols\nexport type BuildOptions =\n    Modify<BuildOptionsOrigin, ReturningOptions>;\n// noinspection JSUnusedGlobalSymbols\nexport type BulkCreateOptions =\n    Modify<BulkCreateOptionsOrigin, ReturningOptions>;\n// noinspection JSUnusedGlobalSymbols\nexport type QueryOptions =\n    Modify<QueryOptionsOrigin, ReturningOptions>;\n// noinspection JSUnusedGlobalSymbols\nexport type UpdateOptions =\n    Modify<UpdateOptionsOrigin, ReturningOptions>;\n// noinspection JSUnusedGlobalSymbols\nexport type CreateOptions =\n    Modify<CreateOptionsOrigin, ReturningOptions>;\n// noinspection JSUnusedGlobalSymbols\nexport type SaveOptions =\n    Modify<InstanceSaveOptionsOrigin, ReturningOptions>;\n\n/**\n * Extends original QueryInterface from sequelize to add support of create/drop\n * views.\n */\nexport interface QueryInterface extends QueryInterfaceOrigin {\n    sequelize: Sequelize;\n    dropView(viewName: string, options?: DropOptions): Promise<any>;\n    createView(viewName: string, viewDefinition: string): Promise<any>;\n}\n\nconst castNumber = (value: any) => +value;\nconst NUMBERS_MAP = new Map<string, (value: any) => number>([\n    [DataType.BIGINT.name, castNumber],\n    [DataType.NUMBER.name, castNumber],\n    [DataType.INTEGER.name, castNumber],\n    [DataType.FLOAT.name, castNumber],\n    [DataType.REAL.name, castNumber],\n    [DataType.DECIMAL.name, castNumber],\n    [DataType.MEDIUMINT.name, castNumber],\n    [DataType.SMALLINT.name, castNumber],\n    [DataType.TINYINT.name, castNumber],\n    [DataType.DOUBLE.name, castNumber],\n]);\n\nfunction fixReturningOptions(options?: ReturningOptions) {\n    if (options &&\n        options.returning &&\n        Array.isArray(options.returning) &&\n        !options.returning.length\n    ) {\n        options.returning = false;\n    }\n}\n\n/**\n * Overrides queryInterface behavior to add support of views definition\n *\n * @param {QueryInterface} queryInterface\n */\nfunction override(queryInterface: QueryInterfaceOrigin): QueryInterface {\n\n    const {\n        insert,\n        upsert,\n        bulkInsert,\n        update,\n        bulkUpdate,\n        bulkDelete,\n        select,\n        increment,\n        rawSelect,\n    } = queryInterface as QueryInterface;\n    const del = (queryInterface as QueryInterface).delete;\n\n    /**\n     * Inserts a new record\n     */\n    (queryInterface as QueryInterface).insert = function(\n        instance: Model,\n        tableName: string,\n        values: object,\n        options?: QueryOptions,\n    ): Promise<object> {\n        fixReturningOptions(options);\n\n        return insert.call(this,\n            instance, tableName, values, options);\n    };\n\n    /**\n     * Inserts or Updates a record in the database\n     */\n    (queryInterface as QueryInterface).upsert = function(\n        tableName: string,\n        values: object,\n        updateValues: object,\n        model: typeof Model,\n        options?: QueryOptions\n    ): Promise<object> {\n        fixReturningOptions(options);\n\n        return upsert.call(this,\n            tableName, values, updateValues, model, options);\n    };\n\n    /**\n     * Inserts multiple records at once\n     */\n    (queryInterface as QueryInterface).bulkInsert = function(\n        tableName: string,\n        records: object[],\n        options?: QueryOptions,\n        attributes?: string[] | string\n    ): Promise<object> {\n        fixReturningOptions(options);\n\n        return bulkInsert.call(this,\n            tableName, records, options, attributes);\n    };\n\n    /**\n     * Updates a row\n     */\n    (queryInterface as QueryInterface).update = function(\n        instance: Model,\n        tableName: string,\n        values: object,\n        identifier: WhereOptions,\n        options?: QueryOptions\n    ): Promise<object> {\n        fixReturningOptions(options);\n\n        return update.call(this,\n            instance, tableName, values, identifier, options);\n    };\n\n    /**\n     * Updates multiple rows at once\n     */\n    (queryInterface as QueryInterface).bulkUpdate = function(\n        tableName: string,\n        values: object,\n        identifier: WhereOptions,\n        options?: QueryOptions,\n        attributes?: string[] | string\n    ): Promise<object> {\n        fixReturningOptions(options);\n\n        return bulkUpdate.call(this,\n            tableName, values, identifier, options, attributes);\n    };\n\n    /**\n     * Deletes a row\n     */\n    (queryInterface as QueryInterface).delete = function(\n        instance: Model | null,\n        tableName: string,\n        identifier: WhereOptions,\n        options?: QueryOptions,\n    ): Promise<object> {\n        fixReturningOptions(options);\n\n        return del.call(this,\n            instance, tableName, identifier, options);\n    };\n\n    /**\n     * Deletes multiple rows at once\n     */\n    (queryInterface as QueryInterface).bulkDelete = function(\n        tableName: string,\n        identifier: WhereOptions,\n        options?: QueryOptions,\n        model?: typeof Model\n    ): Promise<object> {\n        fixReturningOptions(options);\n\n        return bulkDelete.call(this,\n            tableName, identifier, options, model);\n    };\n\n    /**\n     * Returns selected rows\n     */\n    (queryInterface as QueryInterface).select = function(\n        model: typeof Model | null,\n        tableName: string,\n        options?: QueryOptionsWithWhere,\n    ): Promise<object[]> {\n        fixReturningOptions(options as any);\n\n        return select.call(this,\n            model, tableName, options);\n    };\n\n    /**\n     * Increments a row value\n     */\n    (queryInterface as QueryInterface).increment = function(\n        instance: Model,\n        tableName: string,\n        values: object,\n        identifier: WhereOptions,\n        options?: QueryOptions\n    ): Promise<object> {\n        fixReturningOptions(options);\n\n        return increment.call(this,\n            instance, tableName, values, identifier, options);\n    };\n\n    /**\n     * Selects raw without parsing the string into an object\n     */\n    (queryInterface as QueryInterface).rawSelect = function(\n        tableName: string,\n        options: QueryOptionsWithWhere,\n        attributeSelector: string | string[],\n        model?: typeof Model\n    ): Promise<string[]> {\n        fixReturningOptions(options as any);\n\n        return rawSelect.call(this,\n            tableName, options, attributeSelector, model);\n    };\n\n    /**\n     * Drops view from database\n     *\n     * @param {string} viewName - view name to drop\n     * @param {DropOptions} [options] - drop operation options\n     */\n    (queryInterface as QueryInterface).dropView = function(\n        viewName: string,\n        options: DropOptions = {},\n    ) {\n        const dropViewSql = `DROP VIEW IF EXISTS \"${\n            viewName}\"${options.cascade ? ' CASCADE' : ''}`;\n\n        return this.sequelize.query(\n            dropViewSql,\n            this.sequelize.options,\n        );\n    };\n\n    /**\n     * Creates view in a database. Makes sure given view name corresponds to\n     * the name inside given create SQL query.\n     *\n     * @param {string} viewName - view name to create\n     * @param {string} viewDefinition - raw sql query to create the view\n     */\n    (queryInterface as QueryInterface).createView = function(\n        viewName: string,\n        viewDefinition: string,\n    ) {\n        const rx = new RegExp(\n            `\\\\s*create\\\\s+(or\\\\s+replace\\\\s+)?(temp|temporary\\s+)?view\\\\s+\"?${\n                viewName\n            }\"?\\\\s+`,\n            'i',\n        );\n\n        if (!rx.test(viewDefinition)) {\n            throw new TypeError(\n                'Given view definition does not match given view name',\n            );\n        }\n\n        return this.sequelize.query(\n            viewDefinition,\n            this.sequelize.options,\n        );\n    };\n\n    return queryInterface as QueryInterface;\n}\n\n/**\n * Overriding sequelize behavior to support views\n */\nexport class Sequelize extends SequelizeOrigin {\n\n    /**\n     * Returns an instance of QueryInterface.\n     * Supports views.\n     *\n     * @return {QueryInterface}\n     */\n    public getQueryInterface(): QueryInterface {\n        const self: any = this;\n\n        super.getQueryInterface();\n\n        if (typeof self.queryInterface.dropView !== 'function') {\n            self.queryInterface = override(self.queryInterface);\n        }\n\n        return self.queryInterface;\n    }\n\n    /**\n     * Overrides original sequelize define method. Supports views.\n     *\n     * @param {string} modelName\n     * @param {ModelAttributes} attributes\n     * @param {ModelOptions} [options]\n     * @return {typeof BaseModel<TInstance>}\n     */\n    public define<TInstance, TAttributes>(\n        modelName: string,\n        attributes: ModelAttributes,\n        options?: ModelOptions,\n    ): any {\n        const opts: any = options || {};\n\n        opts.modelName = modelName;\n        opts.sequelize = this;\n\n        const model = class extends BaseModel<TInstance> {};\n\n        (model as any).init(attributes, opts);\n\n        return model as any;\n    }\n\n    /**\n     * Sync all defined models to the DB. Including views!\n     *\n     * @param {SyncOptions} [options]\n     * @return {Promise<any>}\n     */\n    public sync(options?: SyncOptions): Promise<any> {\n        const withViews = !options || (options && !options.withNoViews);\n        const syncResult = super.sync(options);\n\n        syncResult.then(async result => {\n            await this.syncIndices(options);\n            return result;\n        });\n\n        return withViews ? syncResult.then(() => this.syncViews()) : syncResult;\n    }\n\n    /**\n     * Synchronizes indices defined for models\n     *\n     * @param {SyncOptions} options\n     * @return {Promise<any>}\n     */\n    public syncIndices(options?: SyncOptions): Promise<any> {\n        return Promise.all(this.getModelsWithIndices().map(model =>\n            model.syncIndices(options)));\n    }\n\n    /**\n     * Syncs all defined views to the DB.\n     *\n     * @return {Promise<any>}\n     */\n    public syncViews(): Promise<any> {\n        const views = this.getViews();\n\n        return Promise.all(views.map((view) => view.syncView()));\n    }\n\n    public getModelsWithIndices() {\n        const models: Array<typeof BaseModel> = [];\n\n        (this as any).modelManager.models.forEach((model: any) => {\n            if (model && model.options &&\n                model.options.indices && model.options.indices.length\n            ) {\n                models.push(model);\n            }\n        });\n\n        return models;\n    }\n\n    /**\n     * Returns list of all defined as views models.\n     *\n     * @return {Array<typeof BaseModel>}\n     */\n    public getViews(): Array<typeof BaseModel> {\n        const views: Array<typeof BaseModel> = [];\n\n        (this as any).modelManager.models.forEach((model: any) => {\n            if (model && model.options && model.options.treatAsView) {\n                views.push(model);\n            }\n        });\n\n        return views;\n    }\n\n    /**\n     * Overriding native query() method to support { returning: string[] }\n     * option for queries in a proper way\n     *\n     * @param {string | { query: string, values: any[] }} sql\n     * @param {QueryOptions} options\n     */\n    public query(\n        sql: string | { query: string, values: any[] },\n        options?: QueryOptions | QueryOptionsWithType<QueryTypes.RAW>,\n    ): Promise<any> {\n        if (options &&\n            Array.isArray((options as QueryOptions).returning) &&\n            ((options as QueryOptions).returning as string[]).length\n        ) {\n            const sqlText = (typeof sql === 'string' ? sql : sql.query)\n                .replace(/returning\\s+\\*/i, `RETURNING ${\n                    ((options as QueryOptions).returning as string[])\n                        .map(field => `\"${field}\"`).join(', ')\n                }`);\n\n            if (typeof sql === 'string') {\n                sql = sqlText;\n            } else {\n                sql.query = sqlText;\n            }\n        }\n\n        const query = super.query;\n\n        return query.call(this, sql, options).then((entities: any) => {\n            if (!(entities && Array.isArray(entities) && entities.length)) {\n                return entities;\n            }\n\n            for (const entity of entities) {\n                if (entity instanceof BaseModel && options) {\n                    // noinspection TypeScriptUnresolvedVariable\n                    (entity as any)._options.returning = (\n                        options as QueryOptions\n                    ).returning;\n                }\n            }\n\n            return entities;\n        });\n    }\n}\n\n/**\n * Base Model class extends native sequelize Model class\n */\nexport abstract class BaseModel<T> extends Model<BaseModel<T>> {\n\n    // noinspection JSUnusedGlobalSymbols\n    /**\n     * Override native drop method to add support of view drops\n     *\n     * @param {DropOptions} options\n     * @return {Promise<any>}\n     */\n    public static drop(options?: DropOptions): Promise<any> {\n        const self: any = this;\n        const method = self.options && self.options.treatAsView\n            ? 'dropView'\n            : 'dropTable';\n\n        // noinspection TypeScriptUnresolvedVariable\n        return self.QueryInterface[method](\n            self.getTableName(),\n            options,\n        );\n    }\n\n    // noinspection JSUnusedGlobalSymbols\n    /**\n     * Sync this Model to the DB, that is create the table. Upon success, the\n     * callback will be called with the model instance (this).\n     * Supports views.\n     *\n     * @param {SyncOptions} [options]\n     */\n    public static sync(options?: SyncOptions): Promise<any> {\n        if ((this as any).options && (this as any).options.treatAsView) {\n            // all views skipped until all tables defined\n            return Promise.resolve();\n        }\n\n        return super.sync(options);\n    }\n\n    /**\n     * Syncs view to the DB.\n     *\n     * @param {SyncOptions} [options]\n     * @return {Promise<any>}\n     */\n    public static syncView(options?: SyncOptions): Promise<any> {\n        const self: any = this;\n\n        // noinspection TypeScriptUnresolvedVariable\n        return self.QueryInterface.dropView(self.getTableName())\n            .then(() => self.QueryInterface.createView(\n                self.getTableName(),\n                self.getViewDefinition(),\n            ));\n    }\n\n    /**\n     * Synchronizes configured indices on this model\n     *\n     * @param {SyncOptions} options\n     * @return {Promise<any>}\n     */\n    public static syncIndices(options?: SyncOptions): Promise<any> {\n        const indices: Array<{\n            column: string;\n            options: ColumnIndexOptions;\n        }> = (this.options as any).indices;\n\n        return Promise.all(indices.map((indexOptions, i) =>\n            this.syncIndex(indexOptions.column, indexOptions.options, i + 1)));\n    }\n\n    /**\n     * Builds and executes index definition SQL query for the given\n     * column and options. Position is used for auto index naming when\n     * index name is auto-generated\n     *\n     * @param {string} column\n     * @param {ColumnIndexOptions} options\n     * @param {number} position\n     * @return {Promise<any>}\n     */\n    public static syncIndex(\n        column: string,\n        options: ColumnIndexOptions,\n        position: number,\n    ) {\n        const self: any = this;\n        const indexName: string = options.name ||\n            `${this.getTableName()}_${column}_idx${position}`;\n        const chain = Promise.resolve(true);\n\n        if (!options.safe) {\n            // noinspection TypeScriptUnresolvedVariable\n            chain.then(() => self.QueryInterface.sequelize.query(`\n                DROP INDEX${options.concurrently\n                    ? ' CONCURRENTLY' : ''} IF EXISTS \"${indexName}\"\n            `));\n        }\n\n        // tslint:disable-next-line:max-line-length\n        // noinspection TypeScriptUnresolvedVariable,PointlessBooleanExpressionJS\n        chain.then(() => self.QueryInterface.sequelize.query(`\n                CREATE${options.unique\n            ? ' UNIQUE' : ''} INDEX${options.concurrently\n            ? ' CONCURRENTLY' : ''}${options.safe\n            ? ' IF NOT EXISTS' : ''} \"${indexName}\"${options.method\n            ? ` USING ${options.method}` : ''} ON \"${\n                this.getTableName()}\" (${options.expression\n            ? `(${options.expression})` : `\"${column}\"`})${options.collation\n            ? ` COLLATE ${options.collation}` : ''}${options.opClass\n            ? ` ${options.opClass}` : ''}${options.order\n            ? ` ${options.order}` : ''}${options.nullsFirst === true\n            ? ' NULLS FIRST' : (options.nullsFirst === false\n                ? ' NULLS LAST' : '')}${options.tablespace\n            ? ` TABLESPACE ${options.tablespace}` : ''}${\n            options.predicate\n                ? ` WHERE ${options.predicate}` : ''}\n            `));\n\n        return chain;\n    }\n\n    /**\n     * Returns view definition SQL string.\n     *\n     * @return {string}\n     */\n    public static getViewDefinition() {\n        return (this as any).options.viewDefinition;\n    }\n\n    // Make sure finders executed on views properly map numeric types\n    /**\n     * Search for multiple instances.\n     *\n     * @see {Sequelize#query}\n     */\n    public static findAll<M>(\n        options?: FindOptions,\n    ): Promise<M[]> {\n        const method = super.findAll;\n        const original =  method.call(this, options);\n\n        if (!(this as any).options.treatAsView) {\n            return original;\n        }\n\n        return original.then((result: any[]) => {\n            if (result && !Array.isArray(result)) {\n                return (result as BaseModel<M>).fixNumbers() as any as M;\n            } else if (result) {\n                result.map((entity: any) =>\n                    entity.fixNumbers() as M);\n            }\n\n            return result as any as M;\n        });\n    }\n\n    // noinspection JSAnnotator\n    /**\n     * Search for a single instance by its primary key. This applies LIMIT 1,\n     * so the listener will always be called with a single instance.\n     */\n    public static findByPk<M>(\n        identifier?: Identifier,\n        options?: Omit<FindOptions, 'where'>,\n    ): Promise<M | null> {\n        const method = super.findByPk;\n        const original =  method.call(this, identifier, options);\n\n        if (!(this as any).options.treatAsView) {\n            return original;\n        }\n\n        return original.then((result: any) => {\n            if (result) {\n                result.fixNumbers();\n            }\n\n            return result as any as M;\n        });\n    }\n\n    // noinspection JSAnnotator\n    /**\n     * Search for a single instance. This applies LIMIT 1, so the listener will\n     * always be called with a single instance.\n     */\n    public static findOne<M>(\n        options?: FindOptions,\n    ): Promise<M | null> {\n        const method = super.findOne;\n        const original =  method.call(this, options);\n\n        if (!(this as any).options.treatAsView) {\n            return original;\n        }\n\n        return original.then((result: any) => {\n            if (result) {\n                result.fixNumbers();\n            }\n\n            return result as any as M;\n        });\n    }\n\n    // noinspection JSUnusedGlobalSymbols\n    /**\n     * Restores native serialization state, clearing returning options\n     * saved during insert/update query execution\n     *\n     * @return {BaseModel}\n     */\n    public restoreSerialization() {\n        // noinspection TypeScriptUnresolvedVariable\n        delete (this as any)._options.returning;\n\n        return this;\n    }\n\n    /**\n     * Appends child node to this entity as if it was joined through query\n     *\n     * @param {string} name\n     * @param {any} data\n     * @return {BaseModel}\n     */\n    public appendChild(name: string, data: any) {\n        // noinspection TypeScriptUnresolvedVariable\n        const returning = (this as any)._options.returning;\n\n        if (returning && !~returning.indexOf(name)) {\n            returning.push(name);\n        }\n\n        (this as any)[name] = data;\n\n        return this;\n    }\n\n    /**\n     * Serializes this model instance to JSON\n     */\n    public toJSON(): any {\n        const serialized: any = toJSON.call(this);\n        const props = Object.keys(this);\n        // noinspection TypeScriptUnresolvedVariable\n        const returning: boolean | string[] = (this as any)._options.returning;\n\n        for (const prop of props) {\n            this.verifyProperty(prop, serialized);\n        }\n\n        if (Array.isArray(returning)) {\n            const serializedProps = Object.keys(serialized);\n\n            for (const prop of serializedProps) {\n                if (!~(returning as string[]).indexOf(prop)) {\n                    delete serialized[prop];\n                }\n            }\n        }\n\n        return serialized;\n    }\n\n    // noinspection JSUnusedGlobalSymbols\n    /**\n     * Casts numeric types to numbers for this model if it\n     * was not properly done during query selection and mapping.\n     * This may occurs sometimes when dealing with Views\n     *\n     * @return {BaseModel}\n     */\n    public fixNumbers(): BaseModel<T> {\n        const model: BaseModel<T> = this.sequelize.models[\n            this.constructor.name\n        ] as any as BaseModel<T>;\n        const columns = Object.keys((model as any).rawAttributes);\n\n        for (const column of columns) {\n            const value = (this as any)[column];\n\n            if (value === undefined) {\n                continue;\n            }\n\n            const cast = NUMBERS_MAP.get(\n                (model as any).rawAttributes[column].type.constructor.name,\n            );\n\n            if (cast) {\n                (this as any)[column] = cast(value);\n            }\n        }\n\n        return this;\n    }\n\n    /**\n     * Makes sure given property properly serialized\n     *\n     * @access private\n     * @param {string} prop\n     * @param {any} serialized\n     */\n    private verifyProperty(prop: string, serialized: any) {\n        // add more skipping props if needed...\n        if (~['__eagerlyLoadedAssociations'].indexOf(prop)) {\n            return ;\n        }\n\n        const val = (this as any)[prop];\n\n        if (!serialized[prop] && val !== this && val instanceof Model) {\n            serialized[prop] = toJSON.call(val);\n        }\n\n        if (val instanceof Array) {\n            this.verifyArray(val, prop, serialized);\n        }\n    }\n\n    /**\n     * Makes sure given array property properly serialized\n     *\n     * @access private\n     * @param {Array<any>} arr\n     * @param {string} prop\n     * @param {any} serialized\n     */\n    private verifyArray(arr: any[], prop: string, serialized: any) {\n        if (!serialized[prop]) {\n            serialized[prop] = [];\n        }\n\n        for (let i = 0; i < arr.length; i++) {\n            const val = (this as any)[prop][i];\n\n            if (val instanceof Model) {\n                serialized[prop][i] = toJSON.call(val);\n            }\n\n            serialized[prop][i] = val && val.toJSON\n                ? val.toJSON()\n                : JSON.parse(JSON.stringify(val));\n        }\n    }\n}\n"]}